import os
try:
    from flask import Flask, jsonify
except:
    print("[!] Error: Flask library not found. Please install it: 'pip3 install flask'")
    os._exit(1)
import middleware
import re

app = Flask(__name__)
middleware.main()

@app.route("/api/cve_exploit/<string:cve>")
def cve_exploit(cve):
    if not re.match(r'((?:CVE|cve)-(?:1999|2\d{3})-(?:0\d{2}[1-9]|[1-9]\d{3,}))', cve):
        return jsonify({"error": "Invalid CVE"}), 400
    results = middleware.cve_exploit(cve)
    if len(results) > 0:
        return jsonify({'exploit_exists': True, 'exploit_count': len(results), 'exploits': results})
    else:
        return jsonify({'exploit_exists': False, 'exploit_count': 0})

if __name__ == "__main__":
    app.run('0.0.0.0', port=5000)